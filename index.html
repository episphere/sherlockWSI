<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherlock WSI Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/openseadragon@latest/build/openseadragon/openseadragon.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/episphere/GeoTIFFTileSource-JPEG2k/GeoTIFFTileSource.js" type="module"
        crossorigin="anonymous"></script>
    <script src="https://episphere.github.io/svs/boxv2/openseadragon-scalebar.js"></script>
    <script src="./index.js"></script>
</head>

<body class="bg-gray-50 text-gray-900 min-h-screen">
    <div class="container mx-auto px-16 py-3 max-w-screen-2xl">
        <!-- Header -->
        <header class="mb-3">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-amber-900">
                        Sherlock WSI Viewer
                    </h1>
                    <div class="flex gap-3 mt-1 text-sm text-blue-600">
                        <a href="https://github.com/episphere/sherlockWSI" target="_blank"
                            class="hover:text-blue-800 hover:underline">
                            GitHub Repository
                        </a>
                        <span class="text-gray-400">|</span>
                        <a href="https://github.com/episphere/sherlockWSI/issues/new" target="_blank"
                            class="hover:text-blue-800 hover:underline">
                            Report Issues
                        </a>
                        <span class="text-gray-400">|</span>
                        <a href="https://www.biorxiv.org/content/10.1101/2025.08.14.670178v2.full.pdf" target="_blank"
                            class="hover:text-blue-800 hover:underline">
                            Manuscript Preprint
                        </a>
                    </div>
                </div>

                <!-- Image Map Upload -->
                <div id="imageMapUploadParent" class="flex items-center gap-2">
                    <label for="imageMapUpload" class="text-sm font-medium text-gray-700">Upload Image Map:</label>
                    <input type="file" id="imageMapUpload" accept=".json" onchange="imageMapUploadHandler()"
                        class="text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                </div>
            </div>

            <!-- Image Selector - More Prominent -->
            <div id="imageSelectorParent"
                class="hidden mt-3 bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500">
                <label for="imageSelect" class="text-sm font-semibold text-gray-700 mr-4">
                    Select Slide Image:
                </label>
                <select id="imageSelect" onchange="sherlockWSI.loadImageFromSelector()"
                    class="w-full md:w-2/3 lg:w-1/2 px-4 py-3 mr-4 text-base border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm hover:border-gray-400 transition-colors cursor-pointer">
                </select>
            </div>
        </header>

        <hr class="border-gray-300 mb-3">

        <!-- Main Viewer Area -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Navigator and Heatmap Thumbnails (left sidebar on desktop) -->
            <div class="lg:col-span-4 xl:col-span-3 space-y-4 lg:order-1 order-1">
                <!-- Navigator -->
                <div class="bg-white rounded-lg shadow-md p-2">
                    <h3 id="navigatorTitle" class="text-sm font-semibold text-gray-700 mb-2">Navigator</h3>
                    <div id="osdNavigatorParent" class="flex justify-center items-center">
                        <div id="osdNavigator" class="border-2 border-gray-300 rounded"></div>
                    </div>
                    <span class="flex items-center gap-2 mt-3">
                        <input type="checkbox" id="overlayHeatmapToggle" onchange="sherlockWSI.toggleHeatmapOverlay()"
                            class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer">
                        <label for="overlayHeatmapToggle" class="text-sm font-medium text-gray-700 cursor-pointer">
                            Overlay Heatmap on Slide
                        </label>
                    </span>
                </div>

                <!-- Heatmap Selector (shows third on mobile, second on desktop) -->
                <div id="heatmapSelectorContainer" class="bg-white rounded-lg shadow-md p-2 hidden lg:order-2 order-3">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">Prediction Heatmaps</h3>
                    <div id="heatmapThumbnailsContainer"
                        class="grid grid-cols-2 gap-3 max-h-96 overflow-y-auto px-2 py-2">
                        <!-- Thumbnails will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Main Viewer (right on desktop, second on mobile) -->
            <div class="lg:col-span-8 xl:col-span-9 lg:order-2 order-2">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <!-- Progress Bar -->
                    <div id="progressBarContainer" class="opacity-0 transition-opacity duration-400">
                        <div id="progressBar" class="h-1 bg-blue-600 shadow-lg transition-all duration-200"
                            style="width: 0%"></div>
                    </div>

                    <!-- OpenSeadragon Viewer -->
                    <div id="openseadragon" class="w-full h-[70vh] lg:h-[80vh] border border-gray-300"></div>

                    <!-- Opacity Control -->
                    <div id="heatmapOpacityControl" class="hidden p-4 bg-gray-50 border-t border-gray-200">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2 min-w-fit">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                                <label for="heatmapOpacitySlider" class="text-sm font-medium text-gray-700">
                                    Heatmap Opacity:
                                </label>
                            </div>
                            <input id="heatmapOpacitySlider" type="range" min="0" max="1" step="0.05" value="0.0"
                                disabled onchange="sherlockWSI.heatmapOpacityChangeHandler()"
                                class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <span id="opacityValue"
                                class="text-sm font-medium text-gray-700 min-w-[3rem] text-right">50%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>